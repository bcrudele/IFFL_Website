<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Impact&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <script src="./css/script.js"></script>
  <link rel="stylesheet" href="styles.css">
  <!-- Standard favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./images/favicon-16x16.png">
  
  <!-- For Android -->
  <link rel="manifest" href="./css/site.webmanifest">
  <meta name="theme-color" content="#ffffff">
  <link rel="icon" type="image/png" sizes="192x192" href="./images/android-chrome-192x192.png">
  
  <!-- For Apple -->
  <link rel="apple-touch-icon" sizes="180x180" href="./images/apple-touch-icon.png">
  <title>Illinois Street Hockey League Homepage</title>
  <style>
      .home {
        background-color: rgb(211, 211, 211);
      padding: 25px;
      margin-bottom: 20px;
      /* width: 1400px; */
      max-width: 100%;
      margin: auto;
      /* width: 90%; */
      width: 990px;
  }
    /* Fix Footer*/
    footer {
      width: 990px;
      margin: auto;
    }

    footer .links {
        text-align: center;
        margin: auto;
    }

    .logo img {
      width: 50px; /* Adjust the width of the logo */
      height: auto; /* Maintain aspect ratio */
      border-radius: 50%; /* Make the logo circular */
      margin-right: 20px; /* Add spacing between logo and links */
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-image: url('./images/gray.jpg');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      margin: auto;
      padding: 20px;
      color: #333;
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 2.2em;
    }

    #onClockBanner {
      background: #007bff;
      color: white;
      padding: 12px;
      font-size: 1.1em;
      text-align: center;
      border-radius: 6px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      
      margin: auto;
      margin-bottom: 20px;
      width: 90%;
    }

    input[type="file"] {
      display: block;
      margin: 0 auto 20px auto;
    }

    table {
      width: 92%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }

    th {
      background: #f1f1f1;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }

    th.sorted-asc::after {
      content: " ▲";
    }

    th.sorted-desc::after {
      content: " ▼";
    }

    td button {
      padding: 6px 12px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    td button:hover {
      background-color: #218838;
    }

    #drafted {
      margin-top: 50px;
      font-size: 1.5em;
      text-align: center;
      color: #222;
    }

    .team-columns {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .team-column {
      flex: 1;
      min-width: 200px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      text-align: center; /* Center align the content */
    }

    .team-column h3 {
      margin-bottom: 10px;
    }

    .team-column ul {
      list-style-type: none;
      padding-left: 0;
    }

    .team-column li {
      padding: 4px 0;
      border-bottom: 1px solid #eee;
    }

    .team-logo {
      max-width: 50px;
      max-height: 50px;
      margin-bottom: 10px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    main {
      background-color: rgb(211, 211, 211);
      width: 990px;
      margin: auto;
    }

    .swipe-text-home {
      background: linear-gradient(to right, black, black, red, black, rgb(0, 0, 0));
      background-size: 500% auto;
      color: transparent;
      -webkit-background-clip: text;
      background-clip: text;
      animation: colorSwipe 2s linear 1 forwards;
      text-align: center;
      text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.3); /* Adds a soft text shadow */
    }

    /* Keyframes for the swipe animation */
    @keyframes colorSwipe {
      0% {
        background-position: 100% 0;
      }
      50% {
        background-position: 0% 0;
      }
      100% {
        background-position: 100% 0;
      }
    }
    .table-container {
      margin: auto;
      width: 90%;
      overflow-x: auto;
    }

    table {
      width: 100%;
      margin: auto;
      min-width: unset; /* Adjust table min-width */
    }

    
  </style>
</head>
<body onload="lastedit()">
  <main>
    <div style="width: 1040px; margin: auto;">
      <div id="nav-placeholder"></div>
      <script src="navLoader.js"></script>
    </div>
    <div class="home">
    <h1 class="swipe-text-home">
      <i>ISHL Draft Tool</i>
    </h1>
    
    <div id="onClockBanner">Waiting for CSV...</div>
    <input type="file" id="fileInput" accept=".csv" />
    <div class="table-container">
      <table id="playerTable">
        <thead>
          <tr>
            <th onclick="sortTable(0)">Player</th>
            <th onclick="sortTable(1)">Position</th>
            <th onclick="sortTable(2)">Role</th>
            <th onclick="sortTable(3)">Tier</th>
            <th onclick="sortTable(4)">2024 Score</th>
            <th onclick="sortTable(5)">2024 PPG</th>
            <th onclick="sortTable(6)">Notes</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <h2 id="drafted" class="swipe-text">Drafted Players</h2>
    <div class="team-columns" id="teamColumns"></div>
    <div style="text-align: center; margin-top: 10px; margin-bottom: 10px;">
      <button onclick="exportDraftResults()" style="padding: 4px 12px; font-size: 13px;">Export Draft Results</button>
      <!-- Download Template Button -->
      <a href="2024_template.csv" download style="margin-left: 10px;">
    <button style="padding: 4px 12px; font-size: 13px;">Download Template</button>
  </a>
    </div>
  <script>
  function getColorForValue(value, min, max, invert = false) {
    const numericValue = parseFloat(value);
    if (isNaN(numericValue)) return ''; // skip invalid

    const range = max - min;
    const greenThreshold = min + range * 0.25;
    const yellowThreshold = min + range * 0.75;

    if (invert) {
      if (numericValue <= greenThreshold) return '#c6efce'; // green
      if (numericValue <= yellowThreshold) return '#fff2cc'; // yellow
      return '#f8d7da'; // red
    } else {
      if (numericValue >= yellowThreshold) return '#c6efce'; // green
      if (numericValue >= greenThreshold) return '#fff2cc'; // yellow
      return '#f8d7da'; // red
    }
  }


  function exportDraftResults() {
    let csvContent = "data:text/csv;charset=utf-8,";

    teamNames.forEach(teamName => {
      const players = Array.from(teamLists[teamName].children).map(li => `"${li.textContent}"`);
      if (players.length > 0) {
        csvContent += `"${teamName}",${players.join(',')}\n`;
      }
    });

    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "draft_results.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    }

    const fileInput = document.getElementById('fileInput');
    const playerTable = document.getElementById('playerTable').getElementsByTagName('tbody')[0];
    const onClockBanner = document.getElementById('onClockBanner');

    const teamNames = ['Toxic Turtles', 'Algonquin Assassins', 'Dundee Demons', 'Chicago Charge'];
    const teamLists = {};
    const teamLogos = {
      "Toxic Turtles": "images/txtpatchpin.png",
      "Algonquin Assassins": "images/algonquinassassin-fix.png",
      "Dundee Demons": "images/dundeedemons-pin.png",
      "Chicago Charge": "images/charge alter 5.1.png"
    };
    const teamColumns = document.getElementById('teamColumns');

    teamNames.forEach((teamName, index) => {
      const div = document.createElement('div');
      div.className = 'team-column';
      const logo = teamLogos[teamName] ? `<img src="${teamLogos[teamName]}" alt="${teamName} logo" class="team-logo" />` : '';
      div.innerHTML = `<h3>${logo} ${teamName}</h3><ul id="teamList${index}"></ul>`;
      teamColumns.appendChild(div);
      teamLists[teamName] = document.getElementById(`teamList${index}`);
    });

    let draftOrder = [];
    const rounds = 20;
    for (let r = 0; r < rounds; r++) {
      const round = r % 2 === 0 ? [...teamNames] : [...teamNames].reverse();
      draftOrder = draftOrder.concat(round);
    }

    let currentPick = 0;

    function updateBanner() {
      if (currentPick >= draftOrder.length) {
        onClockBanner.textContent = "Draft complete";
        onClockBanner.style.backgroundColor = "#6c757d";
        return;
      }

      const team = draftOrder[currentPick];
      onClockBanner.textContent = `${team} is on the clock`;

      const teamColors = {
        "Toxic Turtles": "#006400",
        "Algonquin Assassins": "#808080",
        "Dundee Demons": "#8B0000",
        "Chicago Charge": "#B22222"
      };

      onClockBanner.style.backgroundColor = teamColors[team] || "#007bff";
    }

    fileInput.addEventListener('change', function(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const rows = e.target.result.split('\n');
        const dataRows = rows.slice(1).filter(row => row.trim() !== '');
        const parsed = dataRows.map(row => row.match(/(?:"([^"]*)"|([^,]+))/g));
        
        // Get min/max for score and ppg
        const scores = parsed.map(cols => parseFloat(cols[4])).filter(n => !isNaN(n));
        const ppgs = parsed.map(cols => parseFloat(cols[5])).filter(n => !isNaN(n));
        const minScore = Math.min(...scores);
        const maxScore = Math.max(...scores);
        const minPPG = Math.min(...ppgs);
        const maxPPG = Math.max(...ppgs);

        playerTable.innerHTML = '';
        parsed.forEach(cols => {
          if (cols && cols.length >= 7) {
            const score = cols[4].replace(/^"|"$/g, '');
            const ppg = cols[5].replace(/^"|"$/g, '');

            const scoreColor = getColorForValue(score, minScore, maxScore, true); // inverted logic for 2024 Score
            const ppgColor = getColorForValue(ppg, minPPG, maxPPG);               // standard logic for PPG


            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${cols[0].replace(/^"|"$/g, '')}</td>
              <td>${cols[1].replace(/^"|"$/g, '')}</td>
              <td>${cols[2].replace(/^"|"$/g, '')}</td>
              <td>${cols[3].replace(/^"|"$/g, '')}</td>
              <td style="background-color: ${scoreColor}">${score}</td>
              <td style="background-color: ${ppgColor}">${ppg}</td>
              <td>${cols[6].replace(/^"|"$/g, '')}</td>
              <td><button onclick="draftPlayer(this)">Draft</button></td>
            `;
            playerTable.appendChild(tr);
          }
        });
        updateBanner();
      };

      reader.readAsText(file);
    });

    function draftPlayer(button) {
      if (currentPick >= draftOrder.length) return;
      const team = draftOrder[currentPick];
      const row = button.parentNode.parentNode;
      const playerName = row.cells[0].innerText;
      const li = document.createElement('li');
      li.textContent = playerName;
      teamLists[team].appendChild(li);
      row.remove();
      currentPick++;
      updateBanner();
    }

    function sortTable(columnIndex) {
      const table = document.getElementById("playerTable");
      const rows = Array.from(table.rows);
      const tbody = table.tBodies[0];
      const direction = table.getAttribute('data-sort-direction') === 'asc' ? 'desc' : 'asc';
      table.setAttribute('data-sort-direction', direction);

      const sortedRows = rows.slice(1).sort((a, b) => {
        const cellA = a.cells[columnIndex].innerText.trim();
        const cellB = b.cells[columnIndex].innerText.trim();
        const isNumeric = !isNaN(cellA) && !isNaN(cellB);
        return (isNumeric ? (Number(cellA) - Number(cellB)) : cellA.localeCompare(cellB)) * (direction === 'asc' ? 1 : -1);
      });

      tbody.innerHTML = '';
      sortedRows.forEach(row => tbody.appendChild(row));

      const headers = table.querySelectorAll('th');
      headers.forEach((header, index) => {
        header.classList.remove('sorted-asc', 'sorted-desc');
        if (index === columnIndex) {
          header.classList.add(direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
        }
      });
    }

    // Animate "Waiting for CSV..." message
    let dotCount = 0;
    const maxDots = 3;
    const baseMessage = "Waiting for CSV";
    const animateWaitingMessage = setInterval(() => {
      if (playerTable.children.length > 0) {
        clearInterval(animateWaitingMessage);
        return;
      }
      dotCount = (dotCount + 1) % (maxDots + 1);
      const dots = '.'.repeat(dotCount);
      onClockBanner.textContent = baseMessage + dots;
    }, 500);


  </script>
</div>
<footer class="footer" style="width: 1000px; margin: auto; margin-top: 0px;">
  <a href="../index.html">
    <div class="logo">
      <img src="images/ishl.png" alt="Logo">
    </div>
  </a>

  <div class="links">
    <a href="https://www.instagram.com/ishlhockey/">Instagram</a>
    <a href="https://www.youtube.com/channel/UCb5kpoSNhf9CA7lXG5PmeEA">Youtube</a>
    <a href="#top">Top</a>
  </div>
  
  <div class="last-updated">
    Last updated on: <span id="last-updated-date"></span>
  </div>
</footer>
</main>

</body>

</html>